# Coding Standards và Best Practices

## 1. Component Usage

### Sử dụng Component Chung
- **LUÔN** sử dụng các component từ `@/components/ui/*` và `@/components/form/*` trước khi tự viết component mới
- Nếu component cần thiết không tồn tại, hãy tạo component common trong `@/components/common/*` để tái sử dụng
- Không duplicate code - luôn kiểm tra xem đã có component tương tự chưa

### Component Structure
```jsx
// ✅ Good: Sử dụng component từ ui
import { Button, Input, Card } from '@/components/ui'
import { FormInput, FormSelect } from '@/components/form'

// ❌ Bad: Tự viết lại component đã có
const MyButton = ({ children }) => <button>{children}</button>
```

## 2. Form Management

### React Hook Form
- **BẮT BUỘC** sử dụng `react-hook-form` cho tất cả các form
- Sử dụng các Form components từ `@/components/form/*` (FormInput, FormSelect, FormDate, etc.)
- Luôn validate form với `react-hook-form` validation rules

```jsx
// ✅ Good
import { useForm } from 'react-hook-form'
import { FormInput, FormSelect } from '@/components/form'

const MyForm = () => {
  const { control, handleSubmit } = useForm()
  
  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <FormInput
        control={control}
        name="email"
        label="Email"
        rules={{ required: 'Email is required' }}
      />
    </form>
  )
}

// ❌ Bad: Sử dụng controlled component thủ công
const [email, setEmail] = useState('')
<input value={email} onChange={(e) => setEmail(e.target.value)} />
```

## 3. API Calls với Redux Toolkit (RTK)

### RTK Query cho API Calls
- **BẮT BUỘC** sử dụng RTK Query (RTK Toolkit) cho tất cả API calls
- Định nghĩa API endpoints trong `@/store/api/*`
- Sử dụng `baseApi` từ `@/store/api/baseApi` để extend

```jsx
// ✅ Good: Sử dụng RTK Query
import { useGetUsersQuery, useCreateUserMutation } from '@/store/api/adminApi'

const UsersPage = () => {
  const { data, isLoading, error } = useGetUsersQuery()
  const [createUser] = useCreateUserMutation()
  
  // ...
}

// ❌ Bad: Sử dụng fetch/axios trực tiếp trong component
const fetchUsers = async () => {
  const response = await fetch('/api/users')
  // ...
}
```

### API Structure
```jsx
// ✅ Good: Định nghĩa trong store/api/adminApi.js
import { baseApi } from './baseApi'

export const adminApi = baseApi.injectEndpoints({
  endpoints: (builder) => ({
    getUsers: builder.query({
      query: () => '/users',
    }),
  }),
})
```

## 4. Constants và Magic Values

### Định nghĩa Constants
- **KHUYẾN KHÍCH** định nghĩa constants cho các giá trị so sánh, status, enums
- Tạo file constants trong `@/constants/*` hoặc trong cùng file nếu chỉ dùng local
- Không hardcode magic strings/numbers trong code

```jsx
// ✅ Good: Sử dụng constants
// constants/status.js
export const USER_STATUS = {
  ACTIVE: 'active',
  INACTIVE: 'inactive',
  PENDING: 'pending',
}

// Component
import { USER_STATUS } from '@/constants/status'

if (user.status === USER_STATUS.ACTIVE) {
  // ...
}

// ❌ Bad: Hardcode magic strings
if (user.status === 'active') {
  // ...
}
```

### Constants cho API
```jsx
// ✅ Good
export const API_ENDPOINTS = {
  USERS: '/users',
  APPLICATIONS: '/applications',
  ACADEMIC_RECORDS: '/academic/records',
}

export const QUERY_KEYS = {
  USERS: 'users',
  USER_DETAIL: 'userDetail',
}
```

## 5. Code Style

### Naming Conventions
- Components: PascalCase (`UserProfile.jsx`)
- Functions/Variables: camelCase (`getUserData`, `isLoading`)
- Constants: UPPER_SNAKE_CASE (`USER_STATUS`, `API_ENDPOINTS`)
- Files: Match component/function name

### File Organization
```
src/
  components/
    ui/          # Shadcn UI components
    form/        # Form components với react-hook-form
    common/      # Common reusable components
    layout/      # Layout components
  containers/    # Page-specific containers (chứa nhiều components)
  pages/         # Page components (chỉ import và compose containers)
  store/
    api/        # RTK Query API definitions
    slices/     # Redux slices
  constants/    # Constants và enums
  config/       # Configuration files (routes, etc.)
  utils/        # Utility functions
  lib/          # Library utilities
```

## 6. Page Structure và Code Organization

### Page Structure Pattern
- **1 Page = Nhiều Containers**: Một page nên được tách thành nhiều containers, mỗi container xử lý một phần logic/UI riêng biệt
- **1 Container = Nhiều Components**: Một container chứa nhiều components nhỏ hơn để tái sử dụng
- **Hạn chế file quá dài**: Mỗi file không nên quá 200-300 dòng code. Nếu vượt quá, cần tách thành containers/components nhỏ hơn

### Page Structure Example
```jsx
// ✅ Good: Page chỉ import và compose containers
// pages/Users/index.jsx (50-100 lines)
import UserListContainer from '@/containers/Users/UserListContainer'
import UserFilterContainer from '@/containers/Users/UserFilterContainer'
import UserActionsContainer from '@/containers/Users/UserActionsContainer'

export default function UsersPage() {
  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-3xl font-bold">Users</h1>
        <p className="text-muted-foreground">Manage users</p>
      </div>
      
      <UserFilterContainer />
      <UserActionsContainer />
      <UserListContainer />
    </div>
  )
}

// ✅ Good: Container chứa nhiều components
// containers/Users/UserListContainer.jsx (100-200 lines)
import { useGetUsersQuery } from '@/store/api/adminApi'
import { DataTable } from '@/components/common/DataTable'
import { UserCard } from '@/components/common/UserCard'
import { LoadingSpinner } from '@/components/common/LoadingSpinner'
import { ErrorMessage } from '@/components/common/ErrorMessage'

export default function UserListContainer() {
  const { data, isLoading, error } = useGetUsersQuery()
  
  if (isLoading) return <LoadingSpinner />
  if (error) return <ErrorMessage error={error} />
  
  return (
    <div className="space-y-4">
      <DataTable data={data} />
      <div className="grid grid-cols-3 gap-4">
        {data.map(user => (
          <UserCard key={user.id} user={user} />
        ))}
      </div>
    </div>
  )
}

// ❌ Bad: Tất cả code trong 1 file page (500+ lines)
// pages/Users/index.jsx - QUÁ DÀI!
export default function UsersPage() {
  // 200 lines of filter logic
  // 200 lines of table logic
  // 100 lines of action handlers
  // ...
}
```

### Container Guidelines
- **Containers** nằm trong `src/containers/[PageName]/`
- Mỗi container có trách nhiệm rõ ràng (Filter, List, Form, Actions, etc.)
- Container có thể sử dụng hooks (RTK Query, React Hook Form, etc.)
- Container import và sử dụng components từ `@/components/*`

### Component Guidelines
- **Components** nằm trong `@/components/common/*` hoặc `@/components/ui/*`
- Components nên là presentational (nhận props, render UI)
- Components có thể có logic nhỏ nhưng không nên quá phức tạp
- Mỗi component nên < 150 lines

### File Length Rules
- **Page files**: Tối đa 100-150 lines (chỉ compose containers)
- **Container files**: Tối đa 200-300 lines
- **Component files**: Tối đa 150-200 lines
- Nếu file vượt quá giới hạn, **BẮT BUỘC** phải tách thành nhiều files nhỏ hơn

### Naming Conventions
- **Pages**: `pages/[PageName]/index.jsx` (ví dụ: `pages/Users/index.jsx`)
- **Containers**: `containers/[PageName]/[ContainerName]Container.jsx` (ví dụ: `containers/Users/UserListContainer.jsx`)
- **Components**: `components/common/[ComponentName].jsx` (ví dụ: `components/common/UserCard.jsx`)

## 7. Best Practices

### Performance
- Sử dụng `React.memo` cho components không cần re-render thường xuyên
- Sử dụng `useMemo` và `useCallback` khi cần thiết
- Tránh re-render không cần thiết

### Error Handling
- Luôn handle errors trong API calls
- Sử dụng error states từ RTK Query
- Hiển thị user-friendly error messages

### Type Safety
- Sử dụng JSDoc comments cho function parameters và return types
- Định nghĩa PropTypes hoặc TypeScript types nếu có

## 8. Examples

### Complete Example: Form với RTK Query
```jsx
import { useForm } from 'react-hook-form'
import { FormInput, FormSelect } from '@/components/form'
import { useCreateUserMutation } from '@/store/api/adminApi'
import { USER_ROLES, USER_STATUS } from '@/constants/users'

const CreateUserForm = () => {
  const { control, handleSubmit } = useForm()
  const [createUser, { isLoading }] = useCreateUserMutation()
  
  const onSubmit = async (data) => {
    try {
      await createUser(data).unwrap()
      // Success handling
    } catch (error) {
      // Error handling
    }
  }
  
  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <FormInput
        control={control}
        name="name"
        label="Name"
        rules={{ required: 'Name is required' }}
      />
      <FormSelect
        control={control}
        name="role"
        label="Role"
        options={Object.values(USER_ROLES).map(role => ({
          value: role,
          label: role,
        }))}
      />
    </form>
  )
}
```

## 9. Checklist trước khi commit

- [ ] Page đã được tách thành nhiều containers (nếu page > 150 lines)
- [ ] Container đã được tách thành nhiều components (nếu container > 300 lines)
- [ ] Không có file nào vượt quá giới hạn độ dài

- [ ] Đã sử dụng component chung từ `@/components/ui` hoặc `@/components/form`
- [ ] Form sử dụng `react-hook-form` với Form components
- [ ] API calls sử dụng RTK Query từ `@/store/api/*`
- [ ] Magic values đã được định nghĩa thành constants
- [ ] Code đã pass ESLint check
- [ ] Không có console.log (trừ console.error/warn khi cần)
- [ ] Đã handle errors properly

